<!-- Three-Step Booking Modal Component -->
<!-- This file contains the complete modal HTML that should be included on all pages -->

<!-- Three-Step Booking Modal -->
<div id="bookingModal" class="modal modal--three-step" role="dialog" aria-modal="true"
     aria-labelledby="booking-modal-title" aria-hidden="true" hidden>
  <div class="modal-content">

    <!-- STEP 1: SELECT DATES -->
    <div id="step-1" class="three-step__step active" data-step="1">
      <!-- Header -->
      <header class="three-step-modal__header three-step-modal__header--step-1">
        <h1 id="booking-modal-title" class="three-step-modal__title">Select Dates</h1>
        <button type="button" class="three-step-modal__close-btn" id="closeBookingModal" aria-label="Close booking form">&times;</button>
      </header>

      <!-- Progress Indicator -->
      <div class="three-step-progress">
        <span class="three-step-progress__label">Step 1 of 3</span>
        <div class="three-step-progress__bar">
          <div class="three-step-progress__fill three-step-progress__fill--step-1"></div>
        </div>
      </div>

      <!-- Body -->
      <div class="three-step-modal__body">
        <!-- Calendar -->
        <div class="three-step__calendar-wrapper">
          <div id="bookingCalendar" class="booking-calendar">
            <div class="calendar-header">
              <button type="button" class="calendar-nav" id="prevMonth" aria-label="Previous month">‹</button>
              <h3 class="calendar-month-year" id="currentMonthYear"></h3>
              <button type="button" class="calendar-nav" id="nextMonth" aria-label="Next month">›</button>
            </div>
            <div class="calendar-weekdays">
              <div class="weekday">Sun</div>
              <div class="weekday">Mon</div>
              <div class="weekday">Tue</div>
              <div class="weekday">Wed</div>
              <div class="weekday">Thu</div>
              <div class="weekday">Fri</div>
              <div class="weekday">Sat</div>
            </div>
            <div id="calendarGrid" class="calendar-grid">
              <!-- Calendar days generated by JS -->
            </div>
          </div>
        </div>

        <!-- Date Summary -->
        <div class="three-step__date-summary">
          <div class="three-step__date-summary-item">
            <span class="three-step__date-summary-label">Start Date</span>
            <span class="three-step__date-summary-value" id="selectedStartDate">Not selected</span>
          </div>
          <div class="three-step__date-summary-item">
            <span class="three-step__date-summary-label">Total</span>
            <span class="three-step__date-summary-value" id="rentalDuration">-</span>
          </div>
          <div class="three-step__date-summary-item">
            <span class="three-step__date-summary-label">End Date</span>
            <span class="three-step__date-summary-value" id="selectedEndDate">Not selected</span>
          </div>
        </div>

        <!-- Delivery Time -->
        <div class="three-step__time-section">
          <h2 class="three-step__section-title">Delivery Time</h2>
          <select id="timeSlot" name="timeSlot" class="three-step__time-select" required aria-describedby="timeSlotError">
            <option value="">Select Time</option>
          </select>
          <div class="three-step__error-message" id="timeSlotError" role="alert"></div>
        </div>

        <!-- Availability Status -->
        <div id="availabilityStatus" class="availability-status" role="status" aria-live="polite"></div>
        <div id="loadingIndicator" class="loading-indicator" hidden>
          <span class="spinner"></span> Checking availability...
        </div>
        <div class="three-step__error-message" id="calendarError" role="alert"></div>
      </div>

      <!-- Footer -->
      <footer class="three-step-modal__footer">
        <button type="button" class="three-step-modal__btn three-step-modal__btn-primary" id="step1Next">
          Next
        </button>
      </footer>
    </div>

    <!-- STEP 2: DELIVERY DETAILS & CONTACT INFO -->
    <div id="step-2" class="three-step__step" data-step="2">
      <!-- Mobile Pull Handle -->
      <div class="three-step-modal__pull-handle">
        <div class="three-step-modal__pull-bar"></div>
      </div>

      <!-- Header -->
      <header class="three-step-modal__header three-step-modal__header--step-2">
        <button type="button" class="three-step-modal__back-btn" id="step2Back" aria-label="Go back to previous step">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <p class="three-step-progress__label">Step 2 of 3</p>
      </header>

      <!-- Progress Indicator -->
      <div class="three-step-progress">
        <div class="three-step-progress__bar">
          <div class="three-step-progress__fill three-step-progress__fill--step-2"></div>
        </div>
      </div>

      <!-- Body -->
      <div class="three-step-modal__body">
        <!-- Delivery Details -->
        <div class="three-step__form-section">
          <h2 class="three-step__form-section-title">Delivery Details</h2>

          <div class="three-step__form-group">
            <label for="dropoffAddress" class="three-step__form-label">Street Address</label>
            <input type="text" id="dropoffAddress" name="dropoffAddress" class="three-step__form-input"
                   placeholder="123 Main St" required autocomplete="street-address" aria-describedby="dropoffAddressError">
            <div class="three-step__error-message" id="dropoffAddressError" role="alert"></div>
          </div>

          <div class="three-step__form-row">
            <div class="three-step__form-group">
              <label for="dropoffCity" class="three-step__form-label">City</label>
              <input type="text" id="dropoffCity" name="dropoffCity" class="three-step__form-input"
                     placeholder="Anytown" required autocomplete="address-level2" aria-describedby="dropoffCityError">
              <div class="three-step__error-message" id="dropoffCityError" role="alert"></div>
            </div>

            <div class="three-step__form-group">
              <label for="dropoffZip" class="three-step__form-label">ZIP Code</label>
              <input type="text" id="dropoffZip" name="dropoffZip" class="three-step__form-input"
                     placeholder="12345" required autocomplete="postal-code"
                     pattern="[0-9]{5}(-[0-9]{4})?" aria-describedby="dropoffZipError">
              <div class="three-step__error-message" id="dropoffZipError" role="alert"></div>
            </div>
          </div>

          <div class="three-step__form-group">
            <label for="dropoffNotes" class="three-step__form-label">
              Delivery Notes <span class="three-step__optional-label">(Optional)</span>
            </label>
            <textarea id="dropoffNotes" name="dropoffNotes" class="three-step__form-textarea" rows="3"
                      placeholder="e.g. Leave on the right side of the driveway"></textarea>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="three-step__form-section">
          <h2 class="three-step__form-section-title">Contact Information</h2>

          <div class="three-step__form-group">
            <label for="fullName" class="three-step__form-label">Full Name</label>
            <input type="text" id="fullName" name="fullName" class="three-step__form-input"
                   placeholder="John Doe" required autocomplete="name" aria-describedby="fullNameError">
            <div class="three-step__error-message" id="fullNameError" role="alert"></div>
          </div>

          <div class="three-step__form-group">
            <label for="email" class="three-step__form-label">Email Address</label>
            <input type="email" id="email" name="email" class="three-step__form-input"
                   placeholder="john.doe@example.com" required autocomplete="email" aria-describedby="emailError">
            <div class="three-step__error-message" id="emailError" role="alert"></div>
          </div>

          <div class="three-step__form-group">
            <label for="phone" class="three-step__form-label">Phone Number</label>
            <input type="tel" id="phone" name="phone" class="three-step__form-input"
                   placeholder="(555) 123-4567" required autocomplete="tel" aria-describedby="phoneError">
            <div class="three-step__error-message" id="phoneError" role="alert"></div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="three-step-modal__footer three-step-modal__footer--step-2">
        <button type="button" class="three-step-modal__btn three-step-modal__btn-secondary three-step-modal__btn--half" id="step2BackBtn">
          Back
        </button>
        <button type="button" class="three-step-modal__btn three-step-modal__btn-primary three-step-modal__btn--half" id="step2Next">
          Next
        </button>
      </footer>
    </div>

    <!-- STEP 3: CHECKOUT & PAYMENT -->
    <div id="step-3" class="three-step__step" data-step="3">
      <!-- Header -->
      <header class="three-step-modal__header three-step-modal__header--step-3">
        <button type="button" class="three-step-modal__back-btn" id="step3Back" aria-label="Go back to previous step">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <h2 class="three-step-modal__title">Checkout & Payment</h2>
      </header>

      <!-- Progress Indicator -->
      <div class="three-step-progress">
        <span class="three-step-progress__label">Step 3 of 3</span>
        <div class="three-step-progress__bar">
          <div class="three-step-progress__fill three-step-progress__fill--step-3"></div>
        </div>
      </div>

      <!-- Body -->
      <div class="three-step-modal__body">
        <!-- Payment Summary -->
        <div class="three-step__payment-card">
          <h3 class="three-step__payment-card-title">Payment Summary</h3>
          <div class="three-step__payment-summary">
            <p class="three-step__payment-total">Total</p>
            <p class="three-step__payment-amount">$299</p>
          </div>
          <p class="three-step__payment-description">Includes delivery, pickup, and disposal.</p>
        </div>

        <!-- Payment Method -->
        <div class="three-step__payment-card">
          <h3 class="three-step__payment-card-title">Payment Method</h3>
          <div id="card-container" class="three-step__square-container" aria-label="Credit card information">
            <!-- Square payment form will be inserted here -->
          </div>
        </div>

        <!-- Terms of Service -->
        <div class="three-step__terms-wrapper">
          <input type="checkbox" id="agreeTos" name="agreeTos" class="three-step__terms-checkbox" required aria-describedby="agreeTosError">
          <label for="agreeTos" class="three-step__terms-label">
            I agree to the <a href="#terms" target="_blank" rel="noopener">Terms of Service</a> and <a href="#privacy" target="_blank" rel="noopener">Privacy Policy</a>.
          </label>
        </div>
        <div class="three-step__error-message" id="agreeTosError" role="alert"></div>

        <!-- Form Status -->
        <div id="form-status" class="form-status" role="status" aria-live="polite"></div>
      </div>

      <!-- Footer -->
      <footer class="three-step-modal__footer">
        <button type="submit" class="three-step-modal__btn three-step-modal__btn-primary" id="submitPayment">
          Complete Booking
        </button>
      </footer>
    </div>

    <!-- Hidden elements for compatibility with existing bookNow.js -->
    <button type="button" id="cancelBooking" style="display: none;" aria-label="Cancel booking"></button>
    <button type="button" id="continueToPayment" style="display: none;" aria-label="Continue to payment"></button>
    <input type="hidden" id="deliveryDate" name="deliveryDate">
    <input type="hidden" id="pickupDate" name="pickupDate">
    <div id="paymentSection" style="display: none;"></div>

    <!-- Wrapper form (hidden) to maintain form functionality -->
    <form id="dumpsterBookingForm" novalidate style="display: none;">
      <!-- Form fields are referenced by IDs above -->
    </form>
  </div>
</div>
